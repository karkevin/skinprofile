
  var data =
[
  {
    "name": "SK-II Facial Treatment Essence",
    "description": "This pure, lightweight miracle water is quickly absorbed into the skin. Its formula gently exfoliates and helps moderate the skin's surface renewal cycle.",
    "ing": "Galactomyces Ferment Filtrate (Pitera), Butylene Glycol, Pentylene Glycol, Water, Sodium Benzoate, Methylparaben, Sorbic Acid",
    "type": "toner",
    "price": 225,
    "price_range": "200 - 250",
    "image": "https://images-na.ssl-images-amazon.com/images/I/61wYEzRXLqL._SY679_.jpg",
    "url": "https://www.amazon.com/SK-II-Facial-Treatment-Essence-fl/dp/B002SQ0NOW"
  },
  {
    "name": "Drunk Elephant: B-Hydra™ Intensive Hydration Serum",
    "description": "B-Hydra™ is a cool drink of water for your thirsty skin. This ultra-hydrating vitamin B5 serum replenishes nutrients while delivering hydration throughout the day to improve the look of skin texture and tone.",
    "ing": "Water, Coconut Alkanes, Ammonium Acryloyldimethyltaurate/VP Copolymer, Glycerin, Pentylene Glycol, Sclerocarya Birrea Seed Oil, Wheat Amino Acids, Ananas Sativus (Pineapple) Fruit Extract, Berberis Vulgaris Root Extract, Citrullus Lanatus (Watermelon) Fruit Extract, Lens Esculenta (Lentil) Fruit Extract, Pyrus Malus (Apple) Fruit Extract, Coco-Caprylate/Caprate, Panthenol, Sodium PCA, Sodium Hyaluronate Crosspolymer, Dipotassium Glycyrrhizate, Niacinamide, Cyclodextrin, Sodium Hyaluronate, Sodium Lactate, Phenoxyethanol, Hydroxyproline, Trisodium Ethylenediamine Disuccinate, Citric Acid, Caprylyl Glycol, Chlorphenesin, Ethylhexylglycerin",
    "type": "toner",
    "price": 65,
    "price_range": "50 - 100",
    "image": "https://www.sephora.com/productimages/product/p406712-av-01-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/b-hydra-intensive-hydration-gel-P406712"
  },
  {
    "name": "Shiseido: Urban Environment Oil-Free UV Protector Broad Spectrum Face Sunscreen SPF 42",
    "description": "An ultra-light, oil-free fluid with broad-spectrum SPF 42 for daily protection that absorbs excess sebum for a fresh, matte finish.",
    "ing": "Water, Dimethicone, Isododecane, Sd Alcohol 40-B, Dipropylene Glycol, Ethylhexyl Palmitate, Peg-10 Dimethicone, Glycerin, Polymethylsilsesquioxane, Vinyl Dimethicone/Methicone Silsesquioxane Crosspolymer, Polybutylene Glycol/Ppg-9/1 Copolymer, Dimethicone/Vinyl Dimethicone Crosspolymer, Xylitol, Methyl Methacrylate Crosspolymer, Thiotaurine, Scutellaria Baicalensis Root Extract, Paeonia Albiflora Root Extract, Ononis Spinosa Root Extract, Ectoin, Lauryl Peg-9 Polydimethylsiloxyethyl Dimethicone, Hydrogen Dimethicone, Butylene Glycol, Disodium Edta, Disteardimonium Hectorite, Alumina, Bht, Triethoxycaprylylsilane, Syzygium Jambos Leaf Extract, Tocopherol, Phenoxyethanol, Benzoic Acid, Fragrance, Titanium Dioxide, Mica",
    "type": "sunscreen",
    "price": 42,
    "price_range": "0 - 50",
    "image": "https://www.sephora.com/productimages/sku/s1452002-main-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/urban-environment-oil-free-uv-protector-broad-spectrum-spf-42-for-face-P307405?icid2=shiseido_lp_bestsellers_ca_082018_carouselufe:p307405:product"
  },
  {
    "name": "Fresh: Soy Face Cleanser",
    "description": "A milky, conditioning face cleanser that gently removes makeup and dirt, leaving skin soft, soothed, and healthy-looking.",
    "ing": "Water, Coco-Glucoside, Glycerin, Butylene Glycol, PEG-7 GlycerylCocoate, Xanthan Gum, Soybean Oil, Sunflower Seed Oil, Borago Officinalis Seed Oil, Aloe Barbadensis Leaf Juice, Cucumber Fruit Extract, Rosa Damascena Extract, Rosa Damascena Flower Water, Centaurea Cyanus Flower Extract, Soybean Sterols, Panax Ginseng Root Extract, Rosa Damascena Flower Oil, Mallow Flower Extract, Tocopherol, Ascorbyl Palmitate, PEG-120Methyl Glucose Dioleate, PEG-40Hydrogenated Castor Oil, Caprylyl Glycol, Polysorbate20, Caprylic/Capric Triglyceride, Silica, Benzoic Acid, Disodium EDTA, Citric Acid, Behenyl Alcohol, Glyceryl Stearate, Lecithin, Pentylene Glycol, Hydrolyzed Soy Protein, Caramel, Sodium Benzoate, Potassium Sorbate, Phenoxyethanol",
    "type": "cleanser",
    "price": 47,
    "price_range": "0 - 50",
    "image": "https://www.sephora.com/productimages/sku/s1822733-main-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/soy-face-cleansing-milk-P411016?icid2=products%20grid:p411016:product"
  },
  {
    "name": "philosophy purity made simple",
    "description": "An award-winning, highly effective one-step facial cleanser to tone and hydrate skin.",
    "ing": "Water, Sodium Lauroamphoacetate, Sodium Trideceth Sulfate, Limnanthes Alba (Meadowfoam) Seed Oil, Coco-Glucoside, Coconut Alcohol, Peg-120 Methyl Glucose Dioleate, Glycerin, Carbomer, Isopropyl Alcohol, Polysorbate 20, Citric Acid, Imidazolidinyl Urea, Methylparaben, Aniba Rosaeodora (Rosewood) Wood Oil, Propylparaben, Triethanolamine, Amyris Balsamifera Bark Oil, Bulnesia Sarmientoi Wood Oil, Cymbopogon Martini Oil, Pelargonium Graveolens Flower Oil, Rosa Centifolia Flower Oil, Santalum Album (Sandalwood) Oil, Daucus Carota Sativa (Carrot) Seed Oil, Mimosa Tenuiflora Bark Extract, Ormenis Multicaulis Oil, Piper Nigrum (Pepper) Fruit Oil, Salvia Sclarea (Clary) Oil, Fd&C Yellow No. 5 (Ci 19140)",
    "type": "cleanser",
    "price": 32,
    "price_range": "0 - 50",
    "image": "https://www.sephora.com/productimages/sku/s705988-main-hero.jpg",
    "url": "https://www.sephora.com/ca/en/product/purity-made-simple-P7109"
  },
  {
    "name": "Ren Clean Skincare: Ready Steady Glow Daily AHA Tonic",
    "description": "A toner that provides a daily dose of clean bio active extracts to help the skin exfoliate and give your skin a balanced glow, naturally. ",
    "ing": "Water, Sodium Lactate, Lactic Acid, Heptyl Glucoside, Potassium Azeloyl Diglycinate, Triethyl Citrate, Glyceryl Caprylate, Salix Nigra (Willow) Bark Extract, Benzoic Acid, Citrus Nobilis (Mandarin) Peel Oil, Citrus Aurantium Dulcis (Orange) Flower Oil, Citrus Grandis (Grapefruit) Peel Oil, Citrus Tangerina (Tangerine) Peel Oil, Heptanol, Fragrance, Limonene.",
    "type": "toner",
    "price": 42,
    "price_range": "0 - 50",
    "image": "https://d10qoa1dy3vloz.cloudfront.net/resized/680x854/slots-img/ren/ren092_ren_readysteadyglowdailyahatonic_1_1560x1960-swvqn.jpg",
    "url": "https://www.sephora.com/ca/en/product/ready-steady-glow-daily-aha-tonic-P428095?icid2=products%20grid:p428095:product"
  },
  {
    "name": "La Mer: Creme de la Mer",
    "description": "An ultra-rich moisturizing cream that creates an instant dewy finish.",
    "ing": "Algae (Seaweed) Extract, Mineral Oil, Petrolatum, Glycerin, Isohexadecane, Microcrystalline Wax, Lanolin Alcohol, Citrus Aurantifolia (Lime) Extract, Sesamum Indicum (Sesame) Seed Oil, Eucalyptus Globulus (Eucalyptus) Leaf Oil, Sesamum Indicum (Sesame) Seed Powder, Medicago Sativa (Alfalfa) Seed Powder, Helianthus Annuus (Sunflower) Seedcake, Prunus Amygdalus Dulcis (Sweet Almond) Seed Meal, Sodium Gluconate, Copper Gluconate, Calcium Gluconate, Magnesium Gluconate, Zinc Gluconate, Magnesium Sulfate, Paraffin, Tocopheryl Succinate, Niacin, Water, Beta-Carotene, Decyl Oleate, Aluminum Distearate, Octyldodecanol, Citric Acid, Cyanocobalamin, Magnesium Stearate, Panthenol, Limonene, Geraniol, Linalool, Hydroxycitronellal, Citronellol, Benzyl Salicylate, Citral, Sodium Benzoate, Alcohol Denat., Fragrance",
    "type": "moisturizer",
    "price": 230,
    "price_range": "200 - 250",
    "image": "https://www.sephora.com/productimages/sku/s1932201-main-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/creme-de-la-mer-moisturizing-cream-P416341?icid2=products%20grid:p416341:product",
  },
  {
    "name": "Tatcha: The Water Cream",
    "description": "An oil-free, anti-aging water cream that releases a burst of skin-improving Japanese nutrients, powerful botanicals, and optimal hydration for poreless-looking skin. ",
    "ing": "Water, Saccharomyces/Camellia Sinensis Leaf/Cladosiphon Okamuranus/Rice Ferment Filtrate*, Dimethicone, Propanediol, Glycerin, Diglycerin, Diphenylsiloxy Phenyl Trimethicone, Gold, Belamcanda Chinensis Root Extract, Rosa Multiflora Fruit Extract, Houttuynia Cordata Extract, Sophora Angustifolia Root Extract, Sodium Hyaluronate, Lecithin, Pistacia Lentiscus (Mastic) Gum, Sodium Chloride, Sodium Citrate, Mica, Peg-9 Polydimethylsiloxyethyl Dimethicone, Dimethicone/Peg-10/15 Crosspolymer, Dimethicone/Phenyl Vinyl Dimethicone Crosspolymer, Disodium Edta, Tin Oxide, Titanium Dioxide, Butylene Glycol, Ethylhexylglycerin, Parfum/Fragrance, Alcohol, Phenoxyethanol. *Hadasei-3.",
    "type": "moisturizer",
    "price": 82,
    "price_range": "50 - 100",
    "image": "https://www.sephora.com/productimages/sku/s1932920-main-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/the-water-cream-P418218?icid2=similar%20products:p418218:product",
  },
  {
    "name": "philosophy: renewed hope in a jar",
    "description": "A lightweight, all-day skin-renewing gel cream that hydrates and absorbs quickly into skin for a smooth, matte finish. ",
    "ing": "Water, Glycerin, Pentylene Glycol, Glycolic Acid, Polyacrylamide, Dimethicone, Sodium Hydoxide, Ceteary Alcohol, C13-14 Isoparaffin, Cetyl Alcohol, Ammonium, Acryloyldimenthyltaurate/Vp Copolymer, C12-14 Isoparaffin, Phenoxyethanol, Acrylates Crosspolymer, Xanthan Gum, C13-16 Isoparaffin, Laureth-7, Citric Acid, Cetearyl Glucoside, Polysilicone-11, C13-15 Alkane, Mandelic Acid, Tocopheryl Acetate, Parfum/Fragrance, Disodium Edta, Synthetic Fluorphlogopite, Ethylhexyl Palmitate, Propanediol, Adenosine, Beta-Glucan, Caprylyl Glycol, 1,2-Hexanediol, Evodia Rutaecarpa Fruit Extract, Butylene, Glocol, Limonene, Fauex/Yeast Extract/Extrait De Levure, Benzoic Acid, Magnesium Stearate, Sodium Benzoate, Opuntia, Coccinellifera Flower Extract, Silica Dimethyl Silylate, Citral, Bht, Ethylhexylglycerin, Hyaluronic Acid, Silanetriol, Sodium Hyaluronate, Sorbic Acid, Hexylene, Glycol, Bismuth, Oxychloride (Ci 77163).",
    "type": "moisturizer",
    "price": 62,
    "price_range": "50 - 100",
    "image": "https://www.sephora.com/productimages/sku/s1692581-main-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/renewed-hope-in-jar-gel-cream-P399806?icid2=similar%20products:p399806:product",
  },
  {
    "name": "Youth to the People: Superfood Face Wash",
    "description": "An antioxidant-rich gel cleanser loaded with superfoods—kale, spinach, and green tea—to balance and remove dirt and toxins without stripping the skin. ",
    "ing": "Water, Sodium Cocoyl Glutamate, Cocamidopropyl Betaine, Butylene Glycol, Panthenol, Phenoxyethanol, Ascorbic Acid, Hydroxypropyl Methylcellulose, Tocopheryl Acetate, Lecithin, Brassica Oleracea Capitata (Kale) Leaf Extract, Camellia Sinensis (Green Tea) Leaf Extract, Chamomilla Recutita (Matricaria) Flower Extract, Medicago Sativa (Alfalfa) Leaf Extract, Spinacia Oleracea (Spinach) Leaf Extract, Potassium Sorbate, Parfum, Aloe Barbadensis Leaf Extract, Glycerin, Sodium Benzoate, Ci 75810.",
    "type": "cleanser",
    "price": 45,
    "price_range": "0 - 50",
    "image": "https://www.sephora.com/productimages/sku/s2048270-main-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/superfood-face-wash-P428627?icid2=bestsellerskincare_ca_skugrid_ufe:p428627:product",
  },
]
//var badIngredients = avoid_list;
var badIngredients = [];

$(document).ready(function(){
  $.ajax({
    dataType: 'json',
    url: 'user/server.php',
    type: 'GET',
    data: {"data": "avoid_list"},
    success: function(data) {
      alert(data.avoid_list);
      badIngredients = data.avoid_list;
    }
  });
});

function main(data2){
  productInfo = convertJSON(data);
  document.getElementById("display").innerHTML = displayOutput(getProducts(data2, productInfo, 500));
}

function getJSON(){
  $.ajax({
    url:'./products.json',
    dataType: 'json',
    type: "POST",
    success: function(data){
      return data;
    }
  })
}

function convertJSON(data){
  var productInfo = []

  for (var x in data){

    var y = JSON.parse(JSON.stringify(data[x]))
    productInfo.push([y.name, y.ing.split(', '), y.price]);
  }

  return productInfo;
}

function includes(key, array){
  return (array.indexOf(key) > -1)
}

function suitable(allergens, ingredients){
  if (allergens.length == 0){
    return true
  }
  else if (includes(allergens[0], ingredients)){
    return false;
  }
  else{
    allergens.shift();
    return suitable(allergens, ingredients)
  }
}

function getProducts(allergens, productList, priceCap){
  var match = [];

  for (var x in productList){
    if (suitable(allergens, productList[x][1]) && priceCap >= productList[x][2]){
      match.push([productList[x][0], productList[x][2]])
    }
  }

  return match;
}

function displayOutput(productList){
  output = ""
  for (var x in productList){
    output += productList[x][0] + "<br>" + "Price: $" + productList[x][1] + "<br><br>"
  }

  return output;
}

main(avoid_list);
//document.getElementById("test").innerHTML = displayOutput(getProducts(["milk", "Butylene Glycol", "grass"], productInfo, 50))
