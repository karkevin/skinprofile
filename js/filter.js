

var data =
[
  {
    "name": "SK-II Facial Treatment Essence",
    "description": "This pure, lightweight miracle water is quickly absorbed into the skin. Its formula gently exfoliates and helps moderate the skin's surface renewal cycle.",
    "ing": "Galactomyces Ferment Filtrate (Pitera), Butylene Glycol, Pentylene Glycol, Water, Sodium Benzoate, Methylparaben, Sorbic Acid",
    "type": "essence",
    "price": 225,
    "price_range": "200 - 250",
    "image": "https://images-na.ssl-images-amazon.com/images/I/61wYEzRXLqL._SY679_.jpg",
    "url": "https://www.amazon.com/SK-II-Facial-Treatment-Essence-fl/dp/B002SQ0NOW"
  },
  {
    "name": "Drunk Elephant: B-Hydra™ Intensive Hydration Serum",
    "description": "B-Hydra™ is a cool drink of water for your thirsty skin. This ultra-hydrating vitamin B5 serum replenishes nutrients while delivering hydration throughout the day to improve the look of skin texture and tone.",
    "ing": "Water, Coconut Alkanes, Ammonium Acryloyldimethyltaurate/VP Copolymer, Glycerin, Pentylene Glycol, Sclerocarya Birrea Seed Oil, Wheat Amino Acids, Ananas Sativus (Pineapple) Fruit Extract, Berberis Vulgaris Root Extract, Citrullus Lanatus (Watermelon) Fruit Extract, Lens Esculenta (Lentil) Fruit Extract, Pyrus Malus (Apple) Fruit Extract, Coco-Caprylate/Caprate, Panthenol, Sodium PCA, Sodium Hyaluronate Crosspolymer, Dipotassium Glycyrrhizate, Niacinamide, Cyclodextrin, Sodium Hyaluronate, Sodium Lactate, Phenoxyethanol, Hydroxyproline, Trisodium Ethylenediamine Disuccinate, Citric Acid, Caprylyl Glycol, Chlorphenesin, Ethylhexylglycerin",
    "type": "serum",
    "price": 65,
    "price_range": "50 - 100",
    "image": "https://www.sephora.com/productimages/product/p406712-av-01-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/b-hydra-intensive-hydration-gel-P406712"
  },
  {
    "name": "Shiseido: Urban Environment Oil-Free UV Protector Broad Spectrum Face Sunscreen SPF 42",
    "description": "An ultra-light, oil-free fluid with broad-spectrum SPF 42 for daily protection that absorbs excess sebum for a fresh, matte finish.",
    "ing": "Water, Dimethicone, Isododecane, Sd Alcohol 40-B, Dipropylene Glycol, Ethylhexyl Palmitate, Peg-10 Dimethicone, Glycerin, Polymethylsilsesquioxane, Vinyl Dimethicone/Methicone Silsesquioxane Crosspolymer, Polybutylene Glycol/Ppg-9/1 Copolymer, Dimethicone/Vinyl Dimethicone Crosspolymer, Xylitol, Methyl Methacrylate Crosspolymer, Thiotaurine, Scutellaria Baicalensis Root Extract, Paeonia Albiflora Root Extract, Ononis Spinosa Root Extract, Ectoin, Lauryl Peg-9 Polydimethylsiloxyethyl Dimethicone, Hydrogen Dimethicone, Butylene Glycol, Disodium Edta, Disteardimonium Hectorite, Alumina, Bht, Triethoxycaprylylsilane, Syzygium Jambos Leaf Extract, Tocopherol, Phenoxyethanol, Benzoic Acid, Fragrance, Titanium Dioxide, Mica",
    "type": "sunscreen",
    "price": 42,
    "price_range": "0 - 50",
    "image": "https://www.sephora.com/productimages/sku/s1452002-main-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/urban-environment-oil-free-uv-protector-broad-spectrum-spf-42-for-face-P307405?icid2=shiseido_lp_bestsellers_ca_082018_carouselufe:p307405:product"
  },
  {
    "name": "Fresh: Soy Face Cleanser",
    "description": "A milky, conditioning face cleanser that gently removes makeup and dirt, leaving skin soft, soothed, and healthy-looking.",
    "ing": "Water, Coco-Glucoside, Glycerin, Butylene Glycol, PEG-7 GlycerylCocoate, Xanthan Gum, Soybean Oil, Sunflower Seed Oil, Borago Officinalis Seed Oil, Aloe Barbadensis Leaf Juice, Cucumber Fruit Extract, Rosa Damascena Extract, Rosa Damascena Flower Water, Centaurea Cyanus Flower Extract, Soybean Sterols, Panax Ginseng Root Extract, Rosa Damascena Flower Oil, Mallow Flower Extract, Tocopherol, Ascorbyl Palmitate, PEG-120Methyl Glucose Dioleate, PEG-40Hydrogenated Castor Oil, Caprylyl Glycol, Polysorbate20, Caprylic/Capric Triglyceride, Silica, Benzoic Acid, Disodium EDTA, Citric Acid, Behenyl Alcohol, Glyceryl Stearate, Lecithin, Pentylene Glycol, Hydrolyzed Soy Protein, Caramel, Sodium Benzoate, Potassium Sorbate, Phenoxyethanol",
    "type": "cleanser",
    "price": 47,
    "price_range": "0 - 50",
    "image": "https://www.sephora.com/productimages/sku/s1822733-main-zoom.jpg",
    "url": "https://www.sephora.com/ca/en/product/soy-face-cleansing-milk-P411016?icid2=products%20grid:p411016:product"
  },
  {
    "name": "",
    "ing": "Water, Sodium Lauroamphoacetate, Sodium Trideceth Sulfate, Limnanthes Alba (Meadowfoam) Seed Oil, Coco-Glucoside, Coconut Alcohol, Peg-120 Methyl Glucose Dioleate, Glycerin, Carbomer, Isopropyl Alcohol, Polysorbate 20, Citric Acid, Imidazolidinyl Urea, Methylparaben, Aniba Rosaeodora (Rosewood) Wood Oil, Propylparaben, Triethanolamine, Amyris Balsamifera Bark Oil, Bulnesia Sarmientoi Wood Oil, Cymbopogon Martini Oil, Pelargonium Graveolens Flower Oil, Rosa Centifolia Flower Oil, Santalum Album (Sandalwood) Oil, Daucus Carota Sativa (Carrot) Seed Oil, Mimosa Tenuiflora Bark Extract, Ormenis Multicaulis Oil, Piper Nigrum (Pepper) Fruit Oil, Salvia Sclarea (Clary) Oil, Fd&C Yellow No. 5 (Ci 19140)",
    "type": "cleanser",
    "price": 32
  }
]

//var badIngredients = avoid_list;

function main(){
  productInfo = convertJSON(data);
  document.getElementById("display").innerHTML = displayOutput(getProducts(["grass"], productInfo, 500));
}

function getJSON(){
  $.ajax({
    url:'./products.json',
    dataType: 'json',
    type: "POST",
    success: function(data){
      return data;
    }
  })
}

function convertJSON(data){
  var productInfo = []

  for (var x in data){

    var y = JSON.parse(JSON.stringify(data[x]))
    productInfo.push([y.name, y.ing.split(', '), y.price]);
  }

  return productInfo;
}

function includes(key, array){
  return (array.indexOf(key) > -1)
}

function suitable(allergens, ingredients){
  if (allergens.length == 0){
    return true
  }
  else if (includes(allergens[0], ingredients)){
    return false;
  }
  else{
    allergens.shift();
    return suitable(allergens, ingredients)
  }
}

function getProducts(allergens, productList, priceCap){
  var match = [];

  for (var x in productList){
    if (suitable(allergens, productList[x][1]) && priceCap >= productList[x][2]){
      match.push([productList[x][0], productList[x][2]])
    }
  }

  return match;
}

function displayOutput(productList){
  output = ""
  for (var x in productList){
    output += productList[x][0] + "<br>" + "Price: $" + productList[x][1] + "<br><br>"
  }

  return output;
}

main()
//document.getElementById("test").innerHTML = displayOutput(getProducts(["milk", "Butylene Glycol", "grass"], productInfo, 50))
